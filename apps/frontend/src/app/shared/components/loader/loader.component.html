<!-- Loader Component Template -->
<div 
  class="loader-overlay" 
  [class.fullscreen]="fullscreen"
  [class.inline]="!fullscreen"
  [attr.aria-busy]="true"
  [attr.aria-live]="'polite'"
  [attr.aria-label]="message || ('loader.loading' | translate)"
  role="status"
  [@fadeIn]
>
  <!-- Backdrop (only for fullscreen) -->
  <div 
    class="loader-backdrop" 
    *ngIf="fullscreen"
    [style.background]="backdropColor"
    (click)="onBackdropClick()"
  ></div>
  
  <!-- Loader Container -->
  <div 
    class="loader-container"
    [class.loader-small]="size === 'small'"
    [class.loader-medium]="size === 'medium'"
    [class.loader-large]="size === 'large'"
  >
    <!-- Circular Progress Loader -->
    <div class="loader-spinner" *ngIf="type === 'circular'">
      <mat-progress-spinner
        [mode]="mode"
        [value]="progress"
        [diameter]="getDiameter()"
        [strokeWidth]="strokeWidth"
        [color]="color"
      ></mat-progress-spinner>
      
      <!-- Progress Text (for determinate mode) -->
      <div class="progress-text" *ngIf="mode === 'determinate' && showProgress">
        {{ progress }}%
      </div>
    </div>
    
    <!-- Linear Progress Loader -->
    <div class="loader-linear" *ngIf="type === 'linear'">
      <mat-progress-bar
        [mode]="mode"
        [value]="progress"
        [bufferValue]="bufferValue"
        [color]="color"
      ></mat-progress-bar>
    </div>
    
    <!-- Skeleton Loader -->
    <div class="loader-skeleton" *ngIf="type === 'skeleton'">
      <div class="skeleton-line" *ngFor="let line of skeletonLines; trackBy: trackByIndex">
        <div 
          class="skeleton-shimmer"
          [style.width.%]="line.width"
          [style.height.px]="line.height"
          [style.animation-delay.ms]="line.delay"
        ></div>
      </div>
    </div>
    
    <!-- Dots Loader -->
    <div class="loader-dots" *ngIf="type === 'dots'">
      <span 
        class="dot" 
        *ngFor="let dot of [1,2,3,4]; trackBy: trackByIndex"
        [style.animation-delay.s]="dot * 0.15"
      ></span>
    </div>
    
    <!-- Pulse Loader -->
    <div class="loader-pulse" *ngIf="type === 'pulse'">
      <div class="pulse-ring"></div>
      <div class="pulse-ring"></div>
      <div class="pulse-ring"></div>
      <div class="pulse-core">
        <mat-icon *ngIf="icon">{{ icon }}</mat-icon>
      </div>
    </div>
    
    <!-- Custom Content Loader -->
    <div class="loader-custom" *ngIf="type === 'custom'">
      <ng-content></ng-content>
    </div>
    
    <!-- Loading Message -->
    <div 
      class="loader-message" 
      *ngIf="message"
      [class.message-below]="messagePosition === 'below'"
      [class.message-above]="messagePosition === 'above'"
      [@slideIn]
    >
      <span class="message-text">{{ message | translate }}</span>
      
      <!-- Animated Dots -->
      <span class="message-dots" *ngIf="showMessageDots">
        <span class="message-dot" *ngFor="let i of [1,2,3]" [style.animation-delay.s]="i * 0.2">.</span>
      </span>
    </div>
    
    <!-- Action Buttons (optional) -->
    <div class="loader-actions" *ngIf="showCancel || customActions.length > 0">
      <button 
        mat-button
        color="warn"
        *ngIf="showCancel"
        (click)="onCancel()"
        [disabled]="cancelDisabled"
      >
        <mat-icon>close</mat-icon>
        {{ cancelText | translate }}
      </button>
      
      <button 
        mat-button
        *ngFor="let action of customActions; trackBy: trackByAction"
        [color]="action.color"
        (click)="onCustomAction(action)"
        [disabled]="action.disabled"
      >
        <mat-icon *ngIf="action.icon">{{ action.icon }}</mat-icon>
        {{ action.label | translate }}
      </button>
    </div>
    
    <!-- Time Elapsed (optional) -->
    <div class="loader-timer" *ngIf="showTimer">
      <mat-icon class="timer-icon">timer</mat-icon>
      <span class="timer-text">{{ formatTime(elapsedTime) }}</span>
    </div>
    
    <!-- Tips/Hints (optional) -->
    <div class="loader-tips" *ngIf="tips.length > 0" [@fadeIn]>
      <div class="tip-container">
        <mat-icon class="tip-icon">lightbulb</mat-icon>
        <span class="tip-text">{{ currentTip | translate }}</span>
      </div>
    </div>
  </div>
</div>

<!-- Accessibility Announcements -->
<div class="sr-only" aria-live="assertive" aria-atomic="true">
  <span *ngIf="mode === 'determinate'">
    {{ 'loader.progressUpdate' | translate: { progress: progress } }}
  </span>
</div>
