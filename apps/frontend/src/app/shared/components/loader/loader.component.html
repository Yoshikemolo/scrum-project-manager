<!-- Loader Component Template -->
<div 
  class="loader-overlay" 
  [class.fullscreen]="fullscreen"
  [class.inline]="!fullscreen"
  [@fadeIn]
  role="status"
  [attr.aria-label]="ariaLabel || ('loader.loading' | translate)"
  [attr.aria-busy]="true"
>
  <!-- Backdrop -->
  <div 
    class="loader-backdrop" 
    *ngIf="backdrop && fullscreen"
    [@fadeIn]
  ></div>

  <!-- Main Container -->
  <div 
    class="loader-container"
    [class.loader-card]="showCard"
    [class.loader-transparent]="!showCard"
  >
    <!-- Spinner Types -->
    <ng-container [ngSwitch]="type">
      <!-- Circular Progress -->
      <mat-progress-spinner
        *ngSwitchCase="'circular'"
        mode="indeterminate"
        [diameter]="size"
        [strokeWidth]="strokeWidth"
        [color]="color"
        class="loader-spinner"
      ></mat-progress-spinner>
      
      <!-- Linear Progress -->
      <mat-progress-bar
        *ngSwitchCase="'linear'"
        mode="indeterminate"
        [color]="color"
        class="loader-linear"
      ></mat-progress-bar>
      
      <!-- Dots Animation -->
      <div *ngSwitchCase="'dots'" class="loader-dots">
        <span 
          class="dot" 
          *ngFor="let dot of [1,2,3,4]; let i = index"
          [style.animation-delay.ms]="i * 150"
        ></span>
      </div>
      
      <!-- Pulse Animation -->
      <div *ngSwitchCase="'pulse'" class="loader-pulse">
        <div class="pulse-ring"></div>
        <div class="pulse-ring"></div>
        <div class="pulse-ring"></div>
      </div>
      
      <!-- Skeleton Loader -->
      <div *ngSwitchCase="'skeleton'" class="loader-skeleton">
        <div class="skeleton-line" [style.width.%]="80"></div>
        <div class="skeleton-line" [style.width.%]="100"></div>
        <div class="skeleton-line" [style.width.%]="60"></div>
      </div>
      
      <!-- Custom Content -->
      <div *ngSwitchCase="'custom'" class="loader-custom">
        <ng-content></ng-content>
      </div>
      
      <!-- Default (Circular) -->
      <mat-progress-spinner
        *ngSwitchDefault
        mode="indeterminate"
        [diameter]="size"
        [strokeWidth]="strokeWidth"
        [color]="color"
        class="loader-spinner"
      ></mat-progress-spinner>
    </ng-container>
    
    <!-- Message -->
    <div 
      class="loader-message" 
      *ngIf="message"
      [@slideIn]
    >
      <span class="message-text">{{ message | translate }}</span>
      
      <!-- Animated Dots for Loading Text -->
      <span class="message-dots" *ngIf="showMessageDots">
        <span class="dot-animation">.</span>
        <span class="dot-animation">.</span>
        <span class="dot-animation">.</span>
      </span>
    </div>
    
    <!-- Progress Information -->
    <div 
      class="loader-progress" 
      *ngIf="showProgress && progress !== null"
      [@slideIn]
    >
      <div class="progress-bar-container">
        <mat-progress-bar
          mode="determinate"
          [value]="progress"
          [color]="color"
        ></mat-progress-bar>
      </div>
      <div class="progress-text">
        {{ progress }}%
        <span class="progress-label" *ngIf="progressLabel">
          - {{ progressLabel | translate }}
        </span>
      </div>
    </div>
    
    <!-- Action Buttons -->
    <div 
      class="loader-actions" 
      *ngIf="showCancel || customActions.length > 0"
      [@slideIn]
    >
      <button
        mat-button
        *ngIf="showCancel"
        (click)="onCancel()"
        class="cancel-button"
        [attr.aria-label]="'loader.cancel' | translate"
      >
        <mat-icon>close</mat-icon>
        {{ cancelText || ('loader.cancel' | translate) }}
      </button>
      
      <button
        mat-button
        *ngFor="let action of customActions"
        (click)="onCustomAction(action)"
        [color]="action.color"
        [disabled]="action.disabled"
        class="custom-action-button"
      >
        <mat-icon *ngIf="action.icon">{{ action.icon }}</mat-icon>
        {{ action.label | translate }}
      </button>
    </div>
    
    <!-- Tips/Information -->
    <div 
      class="loader-tip" 
      *ngIf="tip && showTips"
      [@fadeIn]
    >
      <mat-icon class="tip-icon">lightbulb</mat-icon>
      <span class="tip-text">{{ tip | translate }}</span>
    </div>
  </div>
</div>

<!-- Accessibility: Screen Reader Announcements -->
<div class="sr-only" aria-live="polite" aria-atomic="true">
  <span *ngIf="message">{{ message | translate }}</span>
  <span *ngIf="progress !== null">{{ 'loader.progressUpdate' | translate: {progress: progress} }}</span>
</div>
