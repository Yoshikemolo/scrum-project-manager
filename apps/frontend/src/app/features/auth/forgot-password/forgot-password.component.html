<div class="forgot-password-container" @fadeInOut>
  <mat-card class="forgot-password-card">
    <mat-card-header>
      <div class="forgot-password-header">
        <div class="icon-container">
          <mat-icon class="lock-icon">lock_reset</mat-icon>
        </div>
        <h1 class="title">Forgot Your Password?</h1>
        <p class="subtitle">No worries! Enter your email and we'll send you reset instructions.</p>
      </div>
    </mat-card-header>

    <mat-card-content>
      <!-- Success State -->
      <div class="success-state" *ngIf="emailSent()" @fadeInOut>
        <div class="success-icon" @checkmark>
          <mat-icon>check_circle</mat-icon>
        </div>
        <h2 class="success-title">Check Your Email</h2>
        <p class="success-message">
          We've sent password reset instructions to
          <strong>{{ forgotPasswordForm.get('email')?.value }}</strong>
        </p>
        <div class="success-info">
          <mat-icon>info</mat-icon>
          <span>
            If you don't see the email, check your spam folder or 
            <button 
              mat-button 
              color="primary" 
              class="inline-button"
              (click)="resendEmail()"
              [disabled]="!canResend() || isLoading()"
            >
              resend it {{ getCountdownText() }}
            </button>
          </span>
        </div>
        <div class="success-actions">
          <button mat-stroked-button routerLink="/auth/login" class="full-width">
            <mat-icon>arrow_back</mat-icon>
            Back to Login
          </button>
          <button mat-button color="primary" (click)="resetForm()" class="full-width">
            Try Another Email
          </button>
        </div>
      </div>

      <!-- Form State -->
      <form 
        [formGroup]="forgotPasswordForm" 
        (ngSubmit)="onSubmit()" 
        class="forgot-password-form"
        *ngIf="!emailSent()"
        @slideIn
      >
        <!-- Email Field -->
        <mat-form-field appearance="outline" class="full-width">
          <mat-label>Email Address</mat-label>
          <input
            matInput
            type="email"
            formControlName="email"
            placeholder="Enter your registered email"
            autocomplete="email"
            [attr.aria-label]="'Email address input'"
            [attr.aria-invalid]="hasError('email')"
            [attr.aria-describedby]="hasError('email') ? 'email-error' : 'email-hint'"
          />
          <mat-icon matPrefix>email</mat-icon>
          <mat-error id="email-error" *ngIf="hasError('email')">
            {{ getErrorMessage('email') }}
          </mat-error>
          <mat-hint id="email-hint">Enter the email associated with your account</mat-hint>
        </mat-form-field>

        <!-- Blocked Warning -->
        <div class="blocked-warning" *ngIf="resetBlockedUntil()" @fadeInOut>
          <mat-icon>schedule</mat-icon>
          <span>
            Too many attempts. Try again after 
            {{ resetBlockedUntil() | date:'short' }}
          </span>
        </div>

        <!-- Attempts Warning -->
        <div class="attempts-warning" *ngIf="attempts() > 0 && attempts() < maxAttempts" @fadeInOut>
          <mat-icon>warning</mat-icon>
          <span>
            {{ maxAttempts - attempts() }} attempt(s) remaining before temporary block
          </span>
        </div>

        <!-- Submit Button -->
        <button
          mat-raised-button
          color="primary"
          type="submit"
          class="full-width submit-button"
          [disabled]="isSubmitDisabled()"
          [attr.aria-busy]="isLoading()"
        >
          <mat-spinner
            *ngIf="isLoading()"
            diameter="20"
            class="button-spinner"
          ></mat-spinner>
          <span *ngIf="!isLoading()">
            <mat-icon>send</mat-icon>
            Send Reset Instructions
          </span>
          <span *ngIf="isLoading()">Sending...</span>
        </button>

        <!-- Back to Login Link -->
        <div class="form-footer">
          <a routerLink="/auth/login" class="back-link">
            <mat-icon>arrow_back</mat-icon>
            Back to Login
          </a>
        </div>
      </form>
    </mat-card-content>

    <mat-card-footer *ngIf="!emailSent()">
      <div class="footer-info">
        <div class="info-item">
          <mat-icon>security</mat-icon>
          <span>Password reset links expire after 1 hour for security</span>
        </div>
        <div class="info-item">
          <mat-icon>help_outline</mat-icon>
          <span>
            Need help? 
            <a href="/support" target="_blank" rel="noopener noreferrer">Contact Support</a>
          </span>
        </div>
      </div>
    </mat-card-footer>
  </mat-card>

  <!-- Background decoration -->
  <div class="background-decoration">
    <div class="wave wave-1"></div>
    <div class="wave wave-2"></div>
    <div class="wave wave-3"></div>
  </div>
</div>